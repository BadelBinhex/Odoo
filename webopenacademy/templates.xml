<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Buscador-->
    <template id="openacademy_search_box" inherit_id="website.website_search_box">
        <xpath expr="//input[@name='search']" position="attributes">
            <attribute name="data-limit">0</attribute>
            <attribute name="data-display-title">true</attribute>
        </xpath>
        <xpath expr="//div[@role='search']" position="replace">
            <form t-att-action="'/webopenacademy/list_courses/'" method="get"
                t-att-data-snippet="_snippet">
                <t>$0</t>
                <input name="order" type="hidden" class="o_wsale_search_order_by" value="" />
                <t t-raw="0" />
            </form>
        </xpath>
    </template>
    <template id="search_id" name="Search Box">
        <t t-call="webopenacademy.openacademy_search_box">
            <t t-set="action" t-attf-value="keep('/webopenacademy/list_courses/', search=0)" />
        </t>
    </template>

    <!-- Filtros -->
    <template id="sort" customize_show="True" name="Show Sort by">
        <t t-set="list_sorted_asc_label">Sort from 'A' to 'Z'</t>
        <t t-set="list_sorted_desc_label">Sort from 'Z' to 'A'</t>
        <t t-set="website_course_sortable"
            t-value="[
            (list_sorted_asc_label, 'title asc'),
            (list_sorted_desc_label, 'title des')]" />

        <t t-set="website_course_sortable_current"
            t-value="[sort for sort in website_course_sortable if sort[1]==request.params.get('order', '')]" />
        <div class="dropdown mt-2 ml-md-2 dropdown_sorty_by">
            <a role="button" href="#" class="dropdown-toggle btn btn-secondary"
                data-toggle="dropdown">
                <span class="d-none d-lg-inline">
                    <t t-if='len(website_course_sortable_current)'> Sorting by : <t
                            t-raw='website_course_sortable_current[0][0]' />
                    </t>
                    <t t-else='1'>Sort by</t>
                </span>
                <i class="fa fa-sort-amount-asc d-lg-none" />
            </a>
            <div class="dropdown-menu dropdown-menu-right" role="menu">
                <t t-foreach="website_course_sortable" t-as="sortby">
                    <a role="menuitem" rel="noindex,nofollow"
                        t-att-href="keep('/webopenacademy/list_courses/', order=sortby[1])"
                        class="dropdown-item">
                        <span t-raw="sortby[0]" />
                    </a>
                </t>
            </div>
        </div>
    </template>

    <template id="sort_avaible" customize_show="True" name="Filter By">
        <t t-set="session_available">Available Sessions</t>
        <t t-set="coursito_sortable" t-value="[
            (session_available, 'datasesion')
        ]"/>
        <t t-set="website_courses_current" t-value="[sort_avaible for sort_avaible in coursito_sortable if sort_avaible[1]==request.params.get('filtre', '')]"/>
        <div class="dropdown mt-2 ml-md-2 dropdown_sorty_by">
            <a role="button" href="#" class="dropdown-toggle btn btn-secondary" data-toggle="dropdown">
                <span class="d-none d-lg-inline">
                    <t t-if='len(website_courses_current)'>
                        Filter by : <t t-raw='website_courses_current[0][0]'/>
                    </t>
                    <t t-else='1'>
                        Filter by
                    </t> 
                </span>
                <i class="fa fa-sort-amount-asc d-lg-none"/>
            </a>
            <div class="dropdown-menu dropdown-menu-right" role="menu">
                <t t-foreach="coursito_sortable" t-as="sortby">
                    <a role="menuitem" rel="noindex,nofollow" t-att-href="keep('/webopenacademy/list_courses/', filt=sortby[1])" class="dropdown-item">
                        <span t-raw="sortby[0]"/>
                    </a>
                </t>
            </div>
        </div>
    </template>

    <!-- Listado de cursos-->
    <template id="list_courses" name="Open Academy">
        <t t-call="website.layout">
            <div class="oe_structure">
                <div class="container text-center align-center">
                    <br />
                    <center>
                        <h3>Courses</h3>
                    </center>
                    <div
                        class="form-inline flex-md-nowrap justify-content-between justify-content-md-center">
                        <t t-call="webopenacademy.search_id" />
                        <t t-call="webopenacademy.sort" />
                        <t t-call="webopenacademy.sort_avaible"/>
                    </div>
                    <br />
                    <center>
                    <table class="table-striped table table-responsive ">
                        <thead style="font-size: 23px;">
                            <tr>
                                <h6>
                                    <b>
                                        <th>PIC. COURSE</th>
                                        <th>TITLE</th>
                                        <th>RESPONSIBLE</th>
                                        <th>SESSION</th>
                                    </b>
                                </h6>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="courses" t-as="curso">
                                <tr>
                                    <td t-if="curso.picture">
                                        <img
                                            t-att-src="'data:picture/png;base64,%s' % curso.picture.decode('utf-8')"
                                            alt="Avatar Course" style="width:15%; height:auto;" />
                                    </td>
                                    <td t-else="">
                                        <t>No picture</t>
                                    </td>
                                    <td>
                                        <a
                                            t-att-href="'http://10.1.0.52//webopenacademy//course//'+str(curso.id)+'/data'">
                                            <span t-esc="curso.title" />
                                        </a>
                                    </td>
                                    <td>
                                        <span t-esc="curso.responsible.name" />
                                    </td>
                                    <td t-if="curso.datasesion.name">
                                        <a
                                            t-att-href="'/webopenacademy/course/'+str(curso.id)+'/sessions'">
                                            <span t-esc="curso.datasesion.name" />
                                        </a>
                                    </td>
                                    <td t-if="not curso.datasesion.name">
                                        <span>No se ha encontrado sesion relacionada</span>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                    </center>
                        <t
                            class="form-inline flex-md-nowrap justify-content-between justify-content-md-center"
                            t-call="website.pager" />
                </div>
            </div>
        </t>
    </template>


    <!-- Datos del curso seleccionado-->
    <template id="data_course" name="Data Course">
        <t t-call="website.layout">
            <div class="oe_structure">
                <div class="breadcrumbs_searchbar session_breadcrumbs o_portal container mt-3"
                    t-value="True" style="background-color: #f2f2f2;padding: 10px;">
                    <item>
                        <a t-att-href="'/webopenacademy/list_courses/'">All Courses</a>
                    </item>
                    <item>
                        <t>
                            /
                        </t>
                    </item>
                </div>
                <div class="container text-center align-center">
                    <br />
                    <center>
                        <h3>All data</h3>
                    </center>
                    <br />
                    <t t-foreach="coursee" t-as="coursito">
                        <div class="o_container_small">
                            <div class="row d-flex align-items-stretch">
                                <div class="s_col_no_bgcolor pt16 pb16 col-lg-6">
                                    <div class="card bg-white h-100 shadow"
                                        style="box-shadow: #8a817c 0px 8px 16px 0px !important;">

                                        <t t-if="coursito.picture">
                                            <center>
                                                <img
                                                    t-att-src="'data:picture/png;base64,%s' % coursito.picture.decode('utf-8')"
                                                    alt="Avatar
                                            Course"
                                                    class="card-img-top"
                                                    style="width:25%; height:auto; padding-top:25px;" />
                                            </center>
                                        </t>
                                        <div class="card-body">
                                            <h4 class="card-title">
                                                <t t-esc="coursito.title" />
                                            </h4>
                                            <hr class="w-100 mx-auto"
                                                style="border-top-width: 1px; border-top-style: solid;" />
                                            <p t-esc="coursito.description" />
                                            <t t-if="coursito.datasesion.name">
                                                <a
                                                    t-att-href="'/webopenacademy/course/'+str(coursito.id)+'/sessions'"
                                                    class="btn btn-primary">
                                                    <span t-esc="coursito.datasesion.name" />
                                                </a>
                                            </t>
                                            <t t-if="not coursito.datasesion.name">
                                                <span>No se ha encontrado sesion relacionada</span>
                                            </t>
                                        </div>

                                    </div>
                                </div>
                                <div class="s_col_no_bgcolor pt16 pb16 col-lg-6">
                                    <div class="card bg-white h-100 shadow"
                                        style="box-shadow: #8a817c 0px 8px 16px 0px !important;">
                                        <div class="card-body">
                                            <h3 class="card-title">Responsable</h3>
                                            <p class="card-text">
                                                <p t-esc="coursito.responsible.name" />
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="o_container_small ">
                            <div class="row d-flex align-items-stretch">
                                <div class="s_col_no_bgcolor pt16 pb16 col-lg-6">
                                    <div class="card bg-white h-100 shadow"
                                        style="box-shadow: #8a817c 0px 8px 16px 0px !important;">
                                        <div class="card-body">
                                            <h3 class="card-title">Archivos</h3>
                                            <p class="card-text">
                                                <button type="button" class="btn btn-default">
                                                    <a
                                                        t-att-href="'http://10.1.0.52/webopenacademy/course/'+str(coursito.id)+'/archivos'"
                                                        class="btn
                        btn-primary rounded-circle btn-sm">
                                                        <i class="fa fa-paperclip"
                                                            data-original-title="" title=""
                                                            aria-describedby="tooltip546759">
                                                            Archivos</i>
                                                    </a>
                                                </button>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="s_col_no_bgcolor pt16 pb16 col-lg-6">
                                    <div class="card h-100 shadow"
                                        style="box-shadow: #8a817c 0px 8px 16px 0px !important; ">
                                        <h3 class="card-title">Carousel</h3>
                                        <t t-if="coursito.gallery">
                                            <div class="card-body">

                                                <div id="carouselExampleControls"
                                                    class="carousel slide" data-ride="carousel"
                                                    style="background-color: #444140;">
                                                    <div class="carousel-inner">
                                                        <div class="carousel-item active">
                                                            <img class="d-block mx-auto"
                                                                t-att-src="'data:imagenes/png;base64,%s' % imagenes[0].image.decode('utf-8')"
                                                                style="max-width: 50%; height:auto;" />
                                                        </div>
                                                        <t t-foreach="imagenes[1:]" t-as="imageness">
                                                            <div class="carousel-item">
                                                                <img class="d-block mx-auto"
                                                                    t-att-src="'data:imagenes/png;base64,%s' % imageness.image.decode('utf-8')"
                                                                    style="max-width: 50%; height:auto;" />
                                                            </div>
                                                        </t>
                                                    </div>
                                                    <a class="carousel-control-prev"
                                                        href="#carouselExampleControls"
                                                        role="button" data-slide="prev">
                                                        ◀
                                                    </a>
                                                    <a class="carousel-control-next"
                                                        href="#carouselExampleControls"
                                                        role="button" data-slide="next">
                                                        ▶
                                                    </a>
                                                </div>
                                                <div class="row">
                                                    <t t-foreach="images" t-as="image">
                                                        <div class="col-4 mb-3">
                                                            <div class="card">
                                                                <img class="card-img-top"
                                                                    t-att-src="'data:imagenes/png;base64,%s' % imageness.image.decode('utf-8')"
                                                                    alt="Gallery image" />
                                                            </div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                        <t t-else="">
                                            <span>This course don't have pictures</span>
                                        </t>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="card mb-4">
                            <div class="card-body">
                                <h4 class="card-title">Course HTML </h4>
                                <div class="card-text">
                                    <t t-raw="coursito.html_description" />
                                </div>
                            </div>
                        </div>

                    </t>
                </div>
            </div>
        </t>
    </template>
    <!-- Página donde se muestra todos los documentos subidos-->
    <template id="archivos_curso">
        <t t-call="website.layout">
            <div class="oe_structure">
                <div class="breadcrumbs_searchbar session_breadcrumbs o_portal container    mt-3"
                    t-value="True" style="background-color: #f2f2f2;padding: 10px;">
                    <item>
                        <a t-att-href="'/webopenacademy/list_courses/'">All Courses</a>
                    </item>
                    <item>
                        <span>/course/</span>
                    </item>
                    <item>
                        <t t-foreach="id_curso" t-as="cursito_id">
                            <a t-att-href="'/webopenacademy/course/'+str(cursito_id.id)+'/data'"
                                t-esc="cursito_id.id">
                                /data
                            </a>
                        </t>
                    </item>
                </div>
                <div class="container text-center align-center">
                    <t t-name="webopenacademy.archivos_curso">
                        <h1>Archivos del curso</h1>
                        <ul>
                            <t t-foreach="archivos" t-as="archivo">
                                <li style="list-style-type: none;">
                                    <a t-attf-href="/web/content/{{archivo.id}}?download=true"
                                        t-esc="archivo.name"></a>
                                </li>
                            </t>
                        </ul>
                    </t>
                </div>
            </div>
        </t>
    </template>
    <!-- Lista de todas las sesiones-->
    <template id="list_sessions" name="Sessions of courses">
        <t t-call="website.layout">
            <div class="oe_structure">
                <div class="container">
                    <div class="breadcrumbs_searchbar session_breadcrumbs o_portal container mt-3"
                        t-value="True" style="background-color: #f2f2f2;padding: 10px;">
                        <item>
                            <a t-att-href="'/webopenacademy/list_courses'">Courses</a>
                        </item>
                        <item>
                            <a> / </a>
                        </item>
                        <item>
                            <t t-foreach="sessions" t-as="sesionn">
                                <a t-esc="sesionn.name" />
                            </t>
                        </item>
                    </div>
                    <br />
                    <center>
                        <h3>Sessions</h3>
                    </center>
                    <br />
                    <table class="table-striped table table-responsive align-center">
                        <thead style="font-size: 23px;">
                            <tr>
                                <h6>
                                    <b>
                                        <th>NAME SESSION</th>
                                        <th>INSTRUCTORS</th>
                                        <th>START - END DATE</th>
                                        <th>TOTAL SEATS</th>
                                    </b>
                                </h6>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="datetime" t-value="datetime.datetime" />
                            <t t-foreach="sessions" t-as="sesiones">
                                <tr>
                                    <td class="text-left">
                                        <span t-esc="sesiones.name" />
                                    </td>
                                    <td class="text-left">
                                        <span t-esc="sesiones.instructores.name" />
                                    </td>
                                    <td class="text-left">
                                        <span
                                            t-esc="datetime.strptime(str(sesiones.start_date), '%Y-%m-%d').strftime('%d-%m-%Y')" />
                                        - <span
                                            t-esc="datetime.strptime(str(sesiones.end_date), '%Y-%m-%d').strftime('%d-%m-%Y')" />
                                    </td>
                                    <td class="text-left">
                                        <span t-esc="sesiones.seats" />
                                    </td>
                                    <td
                                        t-if="partner not in sessions.register_partners.mapped('id')">
                                        <button type="button" class="btn btn-default">
                                            <a
                                                t-att-href="'http://10.1.0.52//my//sessions//'+str(sesiones.id)+'//updated'"
                                                class="btn btn-primary rounded-circle btn-sm">Join
                                                to Session</a>
                                        </button>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                    <div class="mt32">
                        <h4>
                            <strong>Chatter of Sessions</strong>
                        </h4>
                        <t t-call="portal.message_thread">
                            <t t-set="object" t-value="sessions" />
                            <t t-set="token" t-value="sessions.access_token" />
                            <t t-set="pid" t-value="pid" />
                            <t t-set="hash" t-value="hash" />
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>